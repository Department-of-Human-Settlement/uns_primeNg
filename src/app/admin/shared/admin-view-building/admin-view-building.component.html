<div class="flex gap-4">
    <p-toast></p-toast>

    <div class="w-4 flex flex-column gap-4">
        <div
            style="height: 300px; width: 100%"
            class="border-round"
            id="buildingMap"
        ></div>
        <p-card header="Building" *ngIf="building">
            <div class="flex">
                <div class="flex justify-content-start gap-2">
                    <qrcode
                        *ngIf="building.qrUuid"
                        [qrdata]="getQr(building?.qrUuid)"
                        [errorCorrectionLevel]="'M'"
                        [allowEmptyString]="true"
                        [cssClass]="'center'"
                        [errorCorrectionLevel]="'high'"
                        [colorDark]="'#111827'"
                        [colorLight]="'#FFFFFF00'"
                        [elementType]="'svg'"
                        [errorCorrectionLevel]="'H'"
                        [scale]="1"
                        [title]="'BuildingQr'"
                        [width]="200"
                        class="m-0 p-0"
                    ></qrcode>
                    <div
                        *ngIf="!building.qrUuid"
                        style="width: 200px; height: 200px"
                        class="surface-300 flex justify-content-center align-items-center border-round"
                    >
                        <p>No Building QR</p>
                    </div>
                    <div class="flex flex-column justify-content-center">
                        <p><strong>Building Id:</strong> {{ building.id }}</p>
                        <p><strong>Latitude:</strong> {{ building.lat }}</p>
                        <p><strong>Longitude:</strong> {{ building.lng }}</p>
                        <p>
                            <strong>Address:</strong>
                            {{
                                building.address
                                    ? building.address
                                    : "Adress not assigned"
                            }}
                        </p>
                    </div>
                </div>
            </div>
            <p
                class="text-center w-full font-bold text-sm"
                *ngIf="building.qrUuid"
            >
                <strong>QRUUID:</strong> {{ building.qrUuid }}
            </p>
        </p-card>
    </div>

    <div class="text-sm w-4 flex flex-column gap-4">
        <p-card *ngIf="plots" header="Plot Details">
            <p *ngFor="let plot of plots">
                PlotID : {{ plot.plotId }}, overlap:
                {{ roundDecimal(plot.overlapPercentage) }}%
            </p>
        </p-card>
        <p-card *ngIf="buildingDetails">
            <ng-template pTemplate="header" style="padding: 0; margin: 0">
                <div
                    class="flex justify-content-between align-item-end pt-4 pb-0 mb-0 px-4"
                >
                    <p class="text-gray-700 text-xl font-semibold">
                        Building Details <br />
                        <span class="text-sm font-light"
                            >Last updated:
                            {{ parseDate(buildingDetails.updatedAt) }}></span
                        >
                    </p>

                    <p-button
                        size="small"
                        icon="pi pi-pencil"
                        severity="success"
                    ></p-button>
                </div>
            </ng-template>
            <p class="text-xs text-right"></p>

            <p *ngIf="buildingDetails.buildingName">
                <strong>Building Name:</strong>
                {{ buildingDetails.buildingName }}
            </p>
            <p>
                <strong>Existancy Status:</strong>
                {{ buildingDetails.existancyStatus }}
            </p>
            <p>
                <strong>Associative Position:</strong>
                {{ buildingDetails.associativePosition }}
            </p>
            <p>
                <strong>Use:</strong>
                {{ buildingDetails.use }}
            </p>
            <p>
                <strong>Existancy Status:</strong>
                {{ buildingDetails.existancyStatus }}
            </p>
            <p>
                <strong>Contact Detail: </strong>
                {{ buildingDetails.contact }}
            </p>
            <p>
                <strong>Total Floor:</strong>
                {{ buildingDetails.floorCount }}
            </p>
            <div class="text-sm ml-2">
                <p>
                    <strong>Jamthog:</strong>
                    {{ buildingDetails.jamthogCount }}
                </p>
                <p>
                    <strong>Attic:</strong>
                    {{ buildingDetails.atticCount }}
                </p>
                <p>
                    <strong>Stilt:</strong>
                    {{ buildingDetails.stiltCount }}
                </p>
                <p>
                    <strong>Basements:</strong>
                    {{ buildingDetails.basementCount }}
                </p>
            </div>
        </p-card>

        <p-card *ngIf="!buildingDetails">
            <ng-template pTemplate="header" style="padding: 0; margin: 0">
                <div
                    class="flex justify-content-between align-item-end pt-4 pb-0 mb-0 px-4"
                >
                    <p class="text-gray-700 text-xl font-semibold">
                        Building Details <br />
                    </p>
                </div>
            </ng-template>

            <div>Building Details not added</div>
        </p-card>
    </div>
    <p-card class="w-4" *ngIf="units">
        <ng-template pTemplate="header">
            <div class="flex justify-content-between align-item-end p-4">
                <p class="text-gray-700 text-xl font-semibold">Units</p>
                <p-button
                    icon="pi pi-plus"
                    size="small"
                    severity="success"
                ></p-button>
            </div>
        </ng-template>

        <p-table
            [value]="units"
            [scrollable]="true"
            rowGroupMode="subheader"
            groupRowsBy="unitNumberPrefix"
        >
            <ng-template pTemplate="header">
                <tr>
                    <th>Unit Number</th>
                    <th>Use(Occupancy)</th>
                    <th>Rent</th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="groupheader" let-unit>
                <tr pRowGroupHeader>
                    <td colspan="5" class="surface-200 text-center">
                        Floor: {{ unit.unitNumberPrefix }}
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-unit let-rowIndex="rowIndex">
                <tr>
                    <td>
                        <div class="flex flex-column align-items-center">
                            <p class="font-bold m-0">
                                {{ unit.unitNumberPrefix }}-{{
                                    unit.unitNumber
                                }}
                            </p>
                            <qrcode
                                *ngIf="unit.qrUuid"
                                [qrdata]="getQr(unit.qrUuid)"
                                [errorCorrectionLevel]="'M'"
                                [allowEmptyString]="true"
                                [cssClass]="'center'"
                                [errorCorrectionLevel]="'high'"
                                [colorDark]="'#111827'"
                                [colorLight]="'#FFFFFF00'"
                                [elementType]="'svg'"
                                [errorCorrectionLevel]="'H'"
                                [scale]="1"
                                [title]="'BuildingQr'"
                                [width]="30"
                            ></qrcode>
                        </div>
                    </td>
                    <td>
                        {{ unit.unitDetail?.use }} <br />
                        {{ unit.unitDetail?.occupancyStatus }}
                    </td>

                    <td>{{ unit.unitDetail?.rent }}</td>
                    <td>
                        <div class="flex gap-2">
                            <p-button
                                size="small"
                                [text]="true"
                                [rounded]="true"
                                [outlined]="false"
                                icon="pi pi-pencil"
                                severity="danger"
                                (click)="openEditUnitModal(unit.id)"
                            ></p-button>
                            <p-button
                                size="small"
                                [text]="true"
                                [rounded]="true"
                                [outlined]="false"
                                icon="pi pi-trash"
                                severity="danger"
                            ></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </p-card>
    <p-card class="w-4" *ngIf="!units">
        <ng-template pTemplate="header">
            <div class="flex justify-content-between align-item-end p-4">
                <p class="text-gray-700 text-xl font-semibold">Units</p>
                <p-button
                    icon="pi pi-plus"
                    size="small"
                    severity="success"
                ></p-button>
            </div>
        </ng-template>

        <div>No Unit Details</div>
    </p-card>
</div>
