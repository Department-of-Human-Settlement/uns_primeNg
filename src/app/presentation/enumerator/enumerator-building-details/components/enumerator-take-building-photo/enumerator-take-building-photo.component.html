<div class="relative">
    <div class="relative">
        <!-- Camera view -->
        <video
            #videoElement
            autoplay
            playsinline
            class="w-full h-[80vh] object-cover"
        ></video>

        <!-- Camera loading state -->
        <div
            *ngIf="!isCameraReady"
            class="absolute inset-0 flex flex-column justify-content-center align-items-center bg-black-alpha-50"
        >
            <p-progressSpinner strokeWidth="4" />
            <span class="text-white mt-3">Initializing camera...</span>
        </div>

        <!-- Camera error state -->
        <div
            *ngIf="cameraError"
            class="absolute inset-0 flex flex-column justify-content-center align-items-center bg-black-alpha-50"
        >
            <i class="pi pi-exclamation-circle text-6xl text-red-500 mb-3"></i>
            <span class="text-white">{{ cameraError }}</span>
        </div>

        <!-- Camera controls -->
        <div
            class="absolute bottom-0 left-0 right-0 p-4 flex justify-content-center align-items-center bg-black-alpha-50"
        >
            <button
                *ngIf="!capturedImage"
                pButton
                type="button"
                icon="pi pi-camera"
                class="p-button-rounded p-button-lg"
                (click)="capturePhoto()"
            ></button>
        </div>

        <!-- Preview and upload section -->
        <div
            *ngIf="capturedImage"
            class="absolute inset-0 bg-black-alpha-90 p-4"
        >
            <div class="flex flex-column h-full">
                <div class="flex-grow-1 relative">
                    <img
                        [src]="capturedImage"
                        class="w-full h-full object-contain"
                    />
                </div>

                <div class="flex justify-content-center gap-3 mt-4">
                    <button
                        pButton
                        type="button"
                        icon="pi pi-refresh"
                        label="Retake"
                        class="p-button-outlined"
                        (click)="capturedImage = null"
                    ></button>

                    <button
                        pButton
                        type="button"
                        icon="pi pi-check"
                        label="Upload"
                        [loading]="isUploading"
                        class="p-button-success"
                        (click)="uploadImage()"
                    ></button>
                </div>

                <p-progressBar
                    *ngIf="isUploading"
                    [value]="uploadProgress"
                    class="mt-3"
                ></p-progressBar>
            </div>
        </div>
    </div>
</div>

<p-toast></p-toast>
